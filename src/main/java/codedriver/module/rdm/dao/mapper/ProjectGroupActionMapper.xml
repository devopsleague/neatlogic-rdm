<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="codedriver.module.rdm.dao.mapper.ProjectGroupActionMapper">
    <resultMap id="RoleActionMap" type="codedriver.module.rdm.dto.ProjectGroupActionVo">
        <id column="id" property="id"/>
        <result column="groupUuid" property="groupUuid"/>
        <result column="action" property="action"/>
        <result column="createUser" property="createUser"/>
        <result column="createTime" property="createTime"/>
        <result column="module" property="module"/>
    </resultMap>
    <select id="searchGroupActionByParams" resultMap="RoleActionMap" parameterType="codedriver.module.rdm.dto.ProjectGroupActionVo">
        SELECT
        a.`id`,
        a.`group_uuid` as `groupUuid`,
        a.`action`,
        a.`create_user` as `createUser`,
        a.`create_time` as `createTime`,
        a.`module`
        FROM `rdm_project_group_action` a
        LEFT JOIN `rdm_project_group_action_process` b ON a.id = b.`group_action_id`
        <where>
            <if test="groupUuid != null and groupUuid != ''">
                a.`group_uuid` = #{groupUuid}
            </if>
            <if test="module != null and module != ''">
                AND a.`module` = #{module}
            </if>
            <if test="processAreaUuid != null and processAreaUuid != ''">
                AND  b.`process_area_uuid` = #{processAreaUuid}
            </if>
        </where>
    </select>

    <insert id="insertProjectGroupAction" parameterType="codedriver.module.rdm.dto.ProjectGroupActionVo">
        <selectKey keyProperty="id" resultType="java.lang.Long" order="AFTER">
            select LAST_INSERT_ID() as id
        </selectKey>
        INSERT INTO `rdm_project_group_action`
        (
        `group_uuid`,
        `action`,
        `module`,
        `create_user`,
        `create_time`
        ) VALUES (
        #{groupUuid},
        #{action},
        #{module},
        #{createUser},
        NOW()
        )
    </insert>

    <insert id="insertProjectGroupActionProcess">
        <selectKey keyProperty="id" resultType="java.lang.Long" order="AFTER">
            select LAST_INSERT_ID() as id
        </selectKey>
        INSERT INTO
         `rdm_project_group_action_process`(
         `group_action_id`,
         `process_area_uuid`
         )VALUES(
         #{groupActionId},
         #{processAreaUuid}
         )
    </insert>

    <delete id="deleteProjectGroupAction" parameterType="java.lang.String">
        DELETE FROM `rdm_project_group_action` WHERE `group_uuid` = #{groupUuid}
    </delete>

    <delete id="deleteGroupActionProcessArea" parameterType="java.lang.Long">
        DELETE FROM `rdm_project_group_action_process` WHERE `group_action_id` = #{groupActionId}
    </delete>
</mapper>
